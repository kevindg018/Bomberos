<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomberos Corinto - Gestión de Parqueadero</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #dc2626; /* Rojo Bomberos */
            --secondary: #475569;
            --success: #16a34a;
            --danger: #b91c1c;
            --dark: #0f172a;
            --light: #f8fafc;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        body { background-color: var(--light); color: var(--dark); }

        /* Login */
        #login-screen {
            display: flex; align-items: center; justify-content: center;
            height: 100vh; background: var(--dark);
        }
        .login-card {
            background: white; padding: 2.5rem; border-radius: 1rem; width: 100%; max-width: 400px;
            text-align: center;
        }

        /* Dashboard */
        #dashboard { display: none; padding: 20px; max-width: 1300px; margin: 0 auto; }
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 10px;
            border-bottom: 4px solid var(--primary);
        }

        .card { background: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        h2 { margin-bottom: 1rem; font-size: 1.1rem; color: var(--primary); text-transform: uppercase; font-weight: 700; }

        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; align-items: end; }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.8rem; font-weight: 600; margin-bottom: 5px; color: var(--secondary); }
        input { 
            width: 100%; padding: 0.7rem; border: 1px solid #cbd5e1; 
            border-radius: 0.5rem; font-size: 1rem;
        }

        button {
            padding: 0.7rem 1.5rem; border: none; border-radius: 0.5rem;
            background: var(--primary); color: white; font-weight: 600; cursor: pointer;
            transition: 0.3s;
        }
        button:hover { opacity: 0.9; }
        .btn-danger { background: var(--danger); font-size: 0.8rem; padding: 0.5rem; }
        .btn-print { background: var(--dark); margin-top: 10px; width: 100%; }

        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 0.8rem; text-align: left; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        th { background: #f8fafc; color: var(--secondary); font-size: 0.75rem; text-transform: uppercase; }

        /* Modal */
        #modal-overlay {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000;
        }
        .receipt-box { background: white; padding: 25px; width: 350px; border-radius: 8px; }
        
        #ticket-print { font-family: 'Courier New', monospace; font-size: 13px; }

        @media print {
            body * { visibility: hidden; }
            #ticket-print, #ticket-print * { visibility: visible; }
            #ticket-print { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

    <section id="login-screen">
        <div class="login-card">
            <h2 style="color: var(--primary); margin-bottom: 5px;">BOMBEROS CORINTO</h2>
            <p style="font-size: 0.8rem; margin-bottom: 20px;">Sistema de Parqueadero</p>
            <div class="form-group" style="text-align: left;">
                <label>Usuario</label>
                <input type="text" id="login-user">
            </div>
            <div class="form-group" style="text-align: left;">
                <label>Contraseña</label>
                <input type="password" id="login-pass">
            </div>
            <button style="width: 100%; margin-top: 10px;" onclick="iniciarSesion()">Acceder</button>
        </div>
    </section>

    <main id="dashboard">
        <header>
            <div>
                <h1 style="font-size: 1.4rem;">Sistema de parqueadero - Bomberos de Corinto Cauca</h1>
                <p id="user-welcome" style="font-size: 0.9rem; color: var(--secondary);"></p>
            </div>
            <button onclick="location.reload()" style="background: var(--dark);">Cerrar Sesión</button>
        </header>

        <section class="card">
            <h2>Ingreso de Vehículo</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Placa</label>
                    <input type="text" id="placa" placeholder="ABC-123">
                </div>
                <div class="form-group">
                    <label>Tipo de Vehículo</label>
                    <input type="text" id="tipo" placeholder="Moto, Carro, etc.">
                </div>
                <div class="form-group">
                    <label>Tarifa Hora ($)</label>
                    <input type="number" id="tarifa" placeholder="Ej: 2000">
                </div>
                <div class="form-group">
                    <button onclick="registrarEntrada()" style="width: 100%; background: var(--success);">Registrar Entrada</button>
                </div>
            </div>
        </section>

        <div style="display: grid; grid-template-columns: 2fr 1.2fr; gap: 20px;">
            <section class="card">
                <h2>Vehículos en el Sitio</h2>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table id="tabla-activos">
                        <thead>
                            <tr>
                                <th>Placa</th>
                                <th>Tipo</th>
                                <th>Entrada</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section class="card">
                <h2>Gestión de Usuarios</h2>
                <div class="form-group">
                    <label>Nuevo Usuario</label>
                    <input type="text" id="new-username">
                </div>
                <div class="form-group">
                    <label>Contraseña</label>
                    <input type="password" id="new-password">
                </div>
                <button onclick="crearUsuario()" style="width: 100%; margin-bottom: 15px;">Crear Usuario</button>
                
                <table id="tabla-usuarios">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </div>
    </main>

    <div id="modal-overlay">
        <div class="receipt-box">
            <div id="ticket-print">
                <div style="text-align: center;">
                    <h3>BOMBEROS CORINTO CAUCA</h3>
                    <p>Nit: 891.500.234-1</p>
                    <p>Corinto, Cauca - Colombia</p>
                    <p>********************************</p>
                </div>
                <div id="ticket-info" style="margin: 15px 0;"></div>
                <div style="text-align: center;">
                    <p>********************************</p>
                    <p>¡Gracias por su colaboración!</p>
                </div>
            </div>
            <button class="btn-print no-print" onclick="window.print()">Imprimir Ticket</button>
            <button class="btn-print no-print" style="background: var(--secondary);" onclick="cerrarModal()">Cerrar</button>
        </div>
    </div>

    <script>
        // DATOS INICIALES
        let dbVehiculos = JSON.parse(localStorage.getItem('corinto_parking')) || [];
        let dbUsuarios = JSON.parse(localStorage.getItem('corinto_users')) || [{user: 'admin', pass: '1234'}];

        // INICIO DE SESIÓN
        function iniciarSesion() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            
            const existe = dbUsuarios.find(x => x.user === u && x.pass === p);
            
            if(existe) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('user-welcome').innerText = "Operador: " + u;
                renderVehiculos();
                renderUsuarios();
            } else {
                alert("Usuario o Contraseña incorrectos");
            }
        }

        // GESTIÓN DE VEHÍCULOS
        function registrarEntrada() {
            const placa = document.getElementById('placa').value.toUpperCase();
            const tipo = document.getElementById('tipo').value;
            const tarifa = parseFloat(document.getElementById('tarifa').value);

            if(!placa || !tipo || !tarifa) return alert("Complete todos los campos del vehículo");

            const v = { id: Date.now(), placa, tipo, tarifa, entrada: new Date().toISOString() };
            dbVehiculos.push(v);
            guardarYRefrescar();
            
            document.getElementById('placa').value = "";
            document.getElementById('tipo').value = "";
            document.getElementById('tarifa').value = "";
        }

        function renderVehiculos() {
            const tbody = document.querySelector('#tabla-activos tbody');
            tbody.innerHTML = "";
            dbVehiculos.forEach(v => {
                tbody.innerHTML += `
                    <tr>
                        <td><b>${v.placa}</b></td>
                        <td>${v.tipo}</td>
                        <td>${new Date(v.entrada).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
                        <td><button class="btn-danger" onclick="procesarCobro(${v.id})">Cobrar Salida</button></td>
                    </tr>
                `;
            });
        }

        function procesarCobro(id) {
            const v = dbVehiculos.find(x => x.id === id);
            const ahora = new Date();
            const entrada = new Date(v.entrada);
            const diffMin = Math.floor((ahora - entrada) / 60000);

            let horas = Math.floor(diffMin / 60);
            let minsExtra = diffMin % 60;

            if (horas === 0) horas = 1;
            else if (minsExtra > 5) horas += 1;

            const total = horas * v.tarifa;

            const info = `
                <p><b>PLACA:</b> ${v.placa}</p>
                <p><b>TIPO:</b> ${v.tipo}</p>
                <p><b>INGRESO:</b> ${entrada.toLocaleString()}</p>
                <p><b>SALIDA:</b> ${ahora.toLocaleString()}</p>
                <p><b>TARIFA HORA:</b> $${v.tarifa}</p>
                <p><b>HORAS COBRADAS:</b> ${horas}</p>
                <h2 style="text-align:center; border:none; margin-top:10px;">TOTAL: $${total}</h2>
            `;

            abrirModal(info);
            dbVehiculos = dbVehiculos.filter(x => x.id !== id);
            guardarYRefrescar();
        }

        // GESTIÓN DE USUARIOS
        function crearUsuario() {
            const u = document.getElementById('new-username').value;
            const p = document.getElementById('new-password').value;

            if(!u || !p) return alert("Defina nombre y contraseña");
            
            dbUsuarios.push({user: u, pass: p});
            localStorage.setItem('corinto_users', JSON.stringify(dbUsuarios));
            renderUsuarios();
            
            document.getElementById('new-username').value = "";
            document.getElementById('new-password').value = "";
        }

        function eliminarUsuario(user) {
            if(dbUsuarios.length === 1) return alert("Debe haber al menos un usuario");
            if(confirm("¿Eliminar al usuario " + user + "?")) {
                dbUsuarios = dbUsuarios.filter(x => x.user !== user);
                localStorage.setItem('corinto_users', JSON.stringify(dbUsuarios));
                renderUsuarios();
            }
        }

        function renderUsuarios() {
            const tbody = document.querySelector('#tabla-usuarios tbody');
            tbody.innerHTML = "";
            dbUsuarios.forEach(u => {
                tbody.innerHTML += `
                    <tr>
                        <td>${u.user}</td>
                        <td><button class="btn-danger" onclick="eliminarUsuario('${u.user}')">Borrar</button></td>
                    </tr>
                `;
            });
        }

        // AUXILIARES
        function guardarYRefrescar() {
            localStorage.setItem('corinto_parking', JSON.stringify(dbVehiculos));
            renderVehiculos();
        }

        function abrirModal(c) {
            document.getElementById('ticket-info').innerHTML = c;
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }
    </script>
</body>
</html>